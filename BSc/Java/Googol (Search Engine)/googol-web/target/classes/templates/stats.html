<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Top 10 Pesquisas – Googol</title>
    <link rel="stylesheet" th:href="@{/css/style.css}" />
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
</head>
<body>
<header>
    <a th:href="@{/}" class="mini-logo">Googol</a>
    <nav class="topnav">
        <a th:href="@{/links}">Links para URL</a>
        <a th:href="@{/barrels}">Barrels Ativos</a>
    </nav>
</header>
<main class="main-content">
    <a th:href="@{/}" class="logo">Googol</a>
    <div class="content-area">
        <h2>Top 10 Pesquisas</h2>
        <p style="margin-bottom: 1.5rem; color: var(--text-secondary);">Clique numa pesquisa para ver os seus resultados</p>
        <ul id="stats-list" style="margin-top: 1.5rem;">
            <li th:each="entry : ${topSearches}"
                class="clickable-stat"
                onclick="window.location.href='/search?q=' + encodeURIComponent(this.querySelector('.term-text').textContent)"
                style="display: flex; justify-content: space-between; padding: 0.8rem 1rem; background-color: #f8f9fa; margin-bottom: 0.5rem; border-radius: 8px; border: none;">
                <span th:text="${entry.key}" class="term-text" style="font-weight: 500;"></span>
                <div style="display: flex; align-items: center; gap: 0.6rem;">
                    <span th:text="${entry.value}" class="count-badge" style="background-color: var(--primary); color: white; padding: 0.2rem 0.8rem; border-radius: 12px; font-size: 0.9rem;"></span>
                    <i class="fas fa-search" style="color: #5f6368; font-size: 0.9rem;"></i>
                </div>
            </li>
        </ul>


    </div>
</main>

<script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>
<script>
    // Conecta ao endpoint
    const socket = new SockJS('/ws');
    const stompClient = Stomp.over(socket);

    stompClient.connect({}, function (frame) {
        console.log('Connected: ' + frame);
        stompClient.subscribe('/topic/stats', function (message) {
            const data = JSON.parse(message.body);
            updateStatsList(data);
        });
    });

    function updateStatsList(data) {
        const ul = document.getElementById('stats-list');
        ul.innerHTML = '';

        //palavra->contagem
        const entries = Object.entries(data);

        if (entries.length === 0) {
            const emptyMsg = document.createElement('div');
            emptyMsg.style.textAlign = 'center';
            emptyMsg.style.padding = '2rem 0';
            emptyMsg.innerHTML = '<p>Ainda não há dados de pesquisas para mostrar</p>';
            ul.appendChild(emptyMsg);
            return;
        }

        entries.forEach(([key, value]) => {
            const li = document.createElement('li');
            li.className = 'clickable-stat';
            li.style.display = 'flex';
            li.style.justifyContent = 'space-between';
            li.style.padding = '0.8rem 1rem';
            li.style.backgroundColor = '#f8f9fa';
            li.style.marginBottom = '0.5rem';
            li.style.borderRadius = '8px';
            li.style.border = 'none';
            li.style.cursor = 'pointer';
            li.onclick = function() {
                window.location.href = '/search?q=' + encodeURIComponent(key);
            };

            const keySpan = document.createElement('span');
            keySpan.textContent = key;
            keySpan.className = 'term-text';
            keySpan.style.fontWeight = '500';

            const rightContainer = document.createElement('div');
            rightContainer.style.display = 'flex';
            rightContainer.style.alignItems = 'center';
            rightContainer.style.gap = '0.6rem';

            const valueSpan = document.createElement('span');
            valueSpan.textContent = value;
            valueSpan.className = 'count-badge';
            valueSpan.style.backgroundColor = 'var(--primary)';
            valueSpan.style.color = 'white';
            valueSpan.style.padding = '0.2rem 0.8rem';
            valueSpan.style.borderRadius = '12px';
            valueSpan.style.fontSize = '0.9rem';

            const searchIcon = document.createElement('i');
            searchIcon.className = 'fas fa-search';
            searchIcon.style.color = '#5f6368';
            searchIcon.style.fontSize = '0.9rem';

            rightContainer.appendChild(valueSpan);
            rightContainer.appendChild(searchIcon);

            li.appendChild(keySpan);
            li.appendChild(rightContainer);
            ul.appendChild(li);
        });
    }
</script>
</body>
</html>